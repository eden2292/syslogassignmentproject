@page "/severityDebug"
@using static Globals

<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge">
    
  <MudPaper Elevation="5" Class="pa-2 mr-5 my-5" MaxWidth="20em" MaxHeight="10em">
        <MudSelect T="string" Label="IPs" @bind-Value= "SelectedIP" FullWidth=false Dense=true>
            <MudSelectItem Value="@("")">All</MudSelectItem>
            /* Allow filtering by IP Address within the severity page *\
                        @foreach (string _ipAddress in S_RadioList.UniqueIpAddresses())
                        {
                            <MudSelectItem Value="@_ipAddress" />
                        }
                    </MudSelect>
            </MudPaper>

    <MudTable Items="@_listOfMessages" Hover="true" AllowUnsorted="true" Dense="true" Height="50em" FixedHeader="true" Filter="new Func<SyslogMessage,bool>(FilterFunc1)">
        <HeaderContent>
            <MudTh><MudTableSortLabel SortBy="new Func<SyslogMessage,object>(x => x.ReceivingIP)"></MudTableSortLabel>Recieving IP</MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<SyslogMessage, object>(x => x.SentDateTime)"> Sent Date/Time</MudTableSortLabel></MudTh>
            <MudTh><MudTableSortLabel SortBy="new Func<SyslogMessage, object>(x => x.ReceivedDateTime)">Received Date/Time</MudTableSortLabel></MudTh>
            <MudTh>Transmitter IP</MudTh>
            <MudTh>Severity</MudTh>
            <MudTh>Message</MudTh>
        </HeaderContent>
        
        @foreach (SyslogMessage _msgItem in S_LiveFeedMessages.SyslogMessageList)
        {
            if (_msgItem.Severity == 0)
            {
            <RowTemplate>
                <MudTd Style=@S_ChangingDebugColour>@context.ReceivingIP</MudTd>
                <MudTd Style=@S_ChangingDebugColour>@context.SentDateTime</MudTd>
                <MudTd Style=@S_ChangingDebugColour>@context.ReceivedDateTime</MudTd>
                <MudTd Style=@S_ChangingDebugColour>@context.SenderIP</MudTd>
                <MudTd Style=@S_ChangingDebugColour>@context.Severity</MudTd>
                <MudTd Style=@S_ChangingDebugColour>@context.EndMessage</MudTd>
            </RowTemplate>
            };
        }
            </MudTable>

</MudContainer>

@code {
    //
    String SelectedIP;
    String SelectedSeverity;
  private List<SyslogMessage> _listOfMessages = new List<SyslogMessage>();
  
    private bool FilterFunc1(SyslogMessage element) => FilterFunc(element);

    private bool FilterFunc(SyslogMessage element)
    {
        if (string.IsNullOrWhiteSpace(SelectedIP) && string.IsNullOrWhiteSpace(SelectedSeverity))
            return true;
        if (element.Severity == 0 && SelectedSeverity == "Debug" && (element.SenderIP.Contains(SelectedIP, StringComparison.OrdinalIgnoreCase)))
            return true;
        if (element.Severity == 1 && SelectedSeverity == "Warning" && (element.SenderIP.Contains(SelectedIP, StringComparison.OrdinalIgnoreCase)))
            return true;
        if (element.Severity >= 2 && element.Severity <= 3 && SelectedSeverity == "Error" && (element.SenderIP.Contains(SelectedIP, StringComparison.OrdinalIgnoreCase)))
            return true;
        if (element.Severity >= 4 && SelectedSeverity == "Info" && (element.SenderIP.Contains(SelectedIP, StringComparison.OrdinalIgnoreCase)))
            return true;
        if (element.Severity == 0 && SelectedSeverity == "Debug" && (string.IsNullOrWhiteSpace(SelectedIP)))
            return true;
        if (element.Severity == 1 && SelectedSeverity == "Warning" && (string.IsNullOrWhiteSpace(SelectedIP)))
            return true;
        if (element.Severity >= 2 && element.Severity <= 3 && SelectedSeverity == "Error" && (string.IsNullOrWhiteSpace(SelectedIP)))
            return true;
        if (element.Severity >= 4 && SelectedSeverity == "Info" && (string.IsNullOrWhiteSpace(SelectedIP)))
            return true;
        if (element.SenderIP.Contains(SelectedIP, StringComparison.OrdinalIgnoreCase) && string.IsNullOrWhiteSpace(SelectedSeverity))
            return true;
        return false;
    }
}