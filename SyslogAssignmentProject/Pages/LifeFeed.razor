@using Microsoft.AspNetCore.SignalR;
@using static Globals;
@using Classes;
@page "/"
@inject NavigationManager NavigationManager
@inject ListServicer ServicedMessages


<PageTitle>Syslog Live Feed</PageTitle>

<h1>Live Feed</h1>
<button @onclick="NavigateToSettings">Go to Settings</button>
<p>Received syslog messages are displayed below.</p>

<table class="table">
  <thead>
    <tr>
      <th>Sent Date/Time</th>
      <th>Received Date/Time</th>
      <th>Source of Origin</th>
      <th>Protocol</th>
      <th>Severity</th>
      <th>Message</th>
    </tr>
  </thead>
  <tbody>
    @foreach (SyslogMessage _msgItem in ServicedMessages.ListToService)
    {
      <tr>
        <td>@((_msgItem.SentDateTime is not null) ? _msgItem.SentDateTime.ToString() : "Unknown")</td>
        <td>@_msgItem.ReceivedDateTime.ToString()</td>
        <td>@_msgItem.SenderIP</td>
        <td>@_msgItem.ProtocolType</td>
        <td>@_msgItem.Severity.ToString()</td>
        <td>@((_msgItem.EndMessage is not null) ? _msgItem.EndMessage : "Unknown")</td>
      </tr>
    }
  </tbody>
</table>

@code {
  protected override void OnInitialized()
  {
    ServicedMessages.OnListChange += HandleListChanged;
  }
  private void HandleListChanged()
  {
    ServicedMessages.UpdateList();
  }
  
  private void NavigateToSettings()
  {
    NavigationManager.NavigateTo("/settings");
  }

}