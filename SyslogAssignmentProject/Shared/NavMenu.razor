@using System.Runtime.Loader
@using SyslogAssignmentProject.Classes;
@using SyslogAssignmentProject.Services
@using System.Collections.Generic;
@inject NavigationManager NavigationManager
@inject RadioInjection InjectedRadio
@inject GlobalInjection InjectedGlobals

<MudPaper Width="250px" Elevation="0" Class="py-3">
    <MudNavMenu Color="Color.Info">
        <MudNavLink Href="/" Icon="@Icons.Material.Filled.Dashboard">Live feed</MudNavLink>
        <MudNavLink Href="/settings" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Storage">Settings</MudNavLink>
        <MudNavGroup Title="Radios" Expanded="false">
            @foreach(Radio _currentRadio in InjectedGlobals.S_RadioList.RadioStore)
            {
                if (_currentRadio.IPAddress.Contains('.'))
                {
                    <MudButton OnClick="()=> OnNavigate(_currentRadio)">
                        @($"IPV4|{@_currentRadio.IPAddress.ToString()}|{(@_currentRadio.TransportProtocol)}")
                    </MudButton> 
                }
                if (_currentRadio.IPAddress.Contains(':'))
                {
                    <MudButton OnClick="()=> OnNavigate(_currentRadio)">
                        @($"IPV6|{@_currentRadio.IPAddress.ToString()}|{(@_currentRadio.TransportProtocol)}")
                    </MudButton>
                }
            }
        </MudNavGroup>
        <MudNavGroup Title="Severity" Expanded="false" >
            <MudNavLink Href="/severityDebug">Debug</MudNavLink>
            <MudNavLink Href="/severityInfo">Info</MudNavLink>
            <MudNavLink Href="/severityError">Error</MudNavLink>
            <MudNavLink Href="/severityWarning">Warning</MudNavLink>
        </MudNavGroup>
    </MudNavMenu>
</MudPaper>

@code
{
    public String Radios { get; set; }

    protected override void OnInitialized()
    {
        InjectedGlobals.S_RadioList.ListChanged += HandleListChanged;
    }

    private void HandleListChanged()
    {
        InvokeAsync(() =>{StateHasChanged();});
    }

    public void OnNavigate(Radio radio)
    {
        InjectedRadio.radio = radio;
        NavigationManager.NavigateTo("/radioDisplay", true);
    }

}
